(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{193:function(e,t,a){},194:function(e,t,a){},203:function(e,t,a){},204:function(e,t,a){},205:function(e,t,a){},206:function(e,t,a){},207:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(77),s=a.n(o),c=a(8),i=(a(87),a(2)),l=a(3),u=a(5),m=a(4),h=a(6),p="http://localhost:8000/api",d="salembus-client-auth-token",f={saveAuthToken:function(e){window.localStorage.setItem(d,e)},getAuthToken:function(){return window.localStorage.getItem(d)},clearAuthToken:function(){window.localStorage.removeItem(d)},hasAuthToken:function(){return!!f.getAuthToken()},makeBasicAuthToken:function(e,t){return window.btoa("".concat(e,":").concat(t))}},v=f,g=r.a.createContext({}),b=g,E=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={stopList:[],routeList:[],delaysList:[],authToken:v.getAuthToken(),userName:null,error:null},a.setDelaysList=function(e){a.setState({delaysList:e})},a.setUserName=function(e){a.setState({userName:e})},a.setAuthToken=function(e){a.setState({authToken:e})},a.setStopList=function(e){a.setState({stopList:e})},a.setRouteList=function(e){a.setState({routeList:e})},a.setError=function(e){console.log(e),a.setState({error:e})},a.clearError=function(){a.setState({error:null})},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e={stopList:this.state.stopList,routeList:this.state.routeList,delaysList:this.state.delaysList,error:this.state.error,setError:this.setError,clearError:this.clearError,setStopList:this.setStopList,setRouteList:this.setRouteList,setAuthToken:this.setAuthToken,setDelaysList:this.setDelaysList,authToken:this.state.authToken};return r.a.createElement(g.Provider,{value:e},this.props.children)}}]),t}(n.Component),y=a(17),j=(a(88),a(89),a(78)),S=a.n(j);function O(e){var t;return e.loading&&(t=r.a.createElement("div",{className:"loading"},r.a.createElement("img",{src:S.a,alt:"loading spinner"}))),r.a.createElement(r.a.Fragment,null,t)}a(90);function N(e){var t="message-inactive";return e.isActive&&(t="message-active"),r.a.createElement("div",{className:t},r.a.createElement("div",{className:"message-menu"},r.a.createElement("div",null,"\xd7")),r.a.createElement("p",null,e.message))}var L=a(12);a(79),a(193);function k(){return r.a.createElement("span",{className:"Hyph"}," - ")}function w(e){var t=e.className,a=Object(L.a)(e,["className"]);return r.a.createElement("button",Object.assign({className:["Button",t].join(" ")},a))}function T(e){var t=e.className,a=Object(L.a)(e,["className"]);return r.a.createElement("input",Object.assign({className:["Input",t].join(" ")},a))}function _(e){var t=e.className,a=Object(L.a)(e,["className"]);return r.a.createElement("span",Object.assign({className:["Required",t].join(" ")},a),"*")}function C(e){var t=e.className,a=e.list,n=Object(L.a)(e,["className","list"]),o=["Section",a&&"Section--list",t].filter(Boolean).join(" ");return r.a.createElement("section",Object.assign({className:o},n))}a(194);var A=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).handleLogoutClick=function(){a.context.setAuthToken(null),v.clearAuthToken()},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"renderLogoutLink",value:function(){return r.a.createElement("div",{className:"Header__logged-in"},r.a.createElement(c.b,{onClick:this.handleLogoutClick,to:"/"},"Logout"))}},{key:"renderLoginLink",value:function(){return r.a.createElement("div",{className:"Header__not-logged-in"},r.a.createElement(c.b,{to:"/register"},"Register"),r.a.createElement(k,null),r.a.createElement(c.b,{to:"/login"},"Log in"))}},{key:"renderMenu",value:function(){return r.a.createElement(c.b,{to:"/late"},"Late bus")}},{key:"render",value:function(){return r.a.createElement("nav",{className:"header"},r.a.createElement("h1",null,r.a.createElement(c.b,{to:"/"}," ","Salem Bus")))}}]),t}(n.Component);A.contextType=b;var x={getStops:function(){return fetch("".concat(p,"/stops"),{headers:{}}).then(function(e){return e.ok?e.json():e.json().then(function(e){return Promise.reject(e)})})},getRoutes:function(){return fetch("".concat(p,"/routes"),{headers:{}}).then(function(e){return e.ok?e.json():e.json().then(function(e){return Promise.reject(e)})})},getTimesAtStop:function(e,t){return fetch("".concat(p,"/stops/times/").concat(e,"/").concat(t),{headers:{}}).then(function(e){return e.ok?e.json():e.json().then(function(e){return Promise.reject(e)})})},getDelays:function(){return fetch("".concat(p,"/delays"),{method:"GET",headers:{"content-type":"application/json"}}).then(function(e){return e.ok?e.json():e.json().then(function(e){return Promise.reject(e)})})},postDelay:function(e){return fetch("".concat(p,"/delays"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)}).then(function(e){return e.ok?e.json():e.json().then(function(e){return Promise.reject(e)})})}},I=(a(203),function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={error:null},a.handleSubmitSearch=function(e){e.preventDefault();var t=e.target.stop_id.value;x.getTimesAtStop(t,a.getTime()).then(a.context.setStopList).catch(a.context.setError),x.getDelays().then(a.context.setDelaysList).catch(a.context.clearError)},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"getTime",value:function(){var e=new Date,t=e.getHours(),a=e.getMinutes(),n=e.getSeconds();return("0"+t).slice(-2)+":"+("0"+a).slice(-2)+":"+("0"+n).slice(-2)}},{key:"render",value:function(){return r.a.createElement("div",{className:"search-menu"},r.a.createElement("form",{onSubmit:this.handleSubmitSearch},r.a.createElement("input",{type:"text",name:"stop_id",placeholder:"Enter a stop id"}),r.a.createElement("button",{type:"submit"},"Submit")))}}]),t}(n.Component));function D(e){var t=e.component,a=Object(L.a)(e,["component"]),n=t;return r.a.createElement(y.b,Object.assign({},a,{render:function(e){return v.hasAuthToken()?r.a.createElement(y.a,{to:"/"}):r.a.createElement(n,e)}}))}I.contextType=b;a(204);var R=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"StopListItem"},r.a.createElement("h4",null,this.props.stopId," - ",this.props.routeShortName," - ",this.props.stopName),this.props.stopDesc," ",r.a.createElement("br",null),"Reported arrival: ",this.props.arrival,r.a.createElement("br",null),r.a.createElement(c.b,{to:{pathname:"/late",state:{stopId:this.props.stopId,routeShortName:this.props.routeShortName}}},"Late bus"),r.a.createElement("br",null),"Delay: ",this.props.delay,r.a.createElement("hr",null))}}]),t}(n.Component);R.contextType=b;a(205);var P=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.context.clearError()}},{key:"fetchCurrentDateHour",value:function(){return(new Date).toLocaleString({timeZone:"America/Los_Angeles"}).split(" ")[1].split(":")[0]}},{key:"fetchStopHour",value:function(e){return(e=e.split(":"))[0]-7}},{key:"compareCurrentTimeToStop",value:function(e,t){return parseInt(e)===parseInt(t)}},{key:"renderStops",value:function(){var e=this,t=this.context.stopList,a=void 0===t?[]:t,n=this.context.delaysList;this.fetchCurrentDateHour();a.sort(function(e,t){return e.arrival>t.arrival?1:-1});var o=new Set,s=a.filter(function(e){var t=o.has(e.routeShortName);return o.add(e.routeShortName),!t});return s.map(function(t,a){for(var r=0;r<n.length;r++){var o=/[01][0-9]:[0-5][0-9]:[0-5][0-9]/g.exec(n[r].dateCreated),s=void 0,c=void 0,i=void 0;o&&(s=e.fetchCurrentDateHour(),c=e.fetchStopHour(o[0]),i=e.compareCurrentTimeToStop(s,c)),t.routeShortName===n[r].routeShortName&&!0===i?t.delay=n[r].delayTime:t.delay=""}}),s.map(function(e){return r.a.createElement(R,{key:e.id,stopId:e.stopId,stopCode:e.stopCode,stopName:e.stopName,stopDesc:e.stopDesc,stopLat:e.lat,stopLon:e.lon,arrival:e.arrival,departure:e.departure,tripRouteId:e.tripRouteId,routeShortName:e.routeShortName,routeLongName:e.routeLongName,delay:e.delay})})}},{key:"render",value:function(){var e=this.context.error;return r.a.createElement(r.a.Fragment,null,r.a.createElement(I,null),r.a.createElement(C,{list:!0,className:"StopsListPage"},e?r.a.createElement("p",{className:"red"},"There was an error, try again"):this.renderStops()))}}]),t}(n.Component);P.contextType=b;var F={postLogin:function(e){var t=e.user_name,a=e.password;return fetch("".concat(p,"/auth/login"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({user_name:t,password:a})}).then(function(e){return e.ok?e.json():e.json().then(function(e){return Promise.reject(e)})})},postUser:function(e){return fetch("".concat(p,"/users"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)}).then(function(e){return e.ok?e.json():e.json().then(function(e){return Promise.reject(e)})})}},H=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={error:null,authToken:null},a.handleSubmitJwtAuth=function(e){e.preventDefault(),a.setState({error:null});var t=e.target,n=t.user_name,r=t.password;F.postLogin({user_name:n.value,password:r.value}).then(function(e){n.value="",r.value="",a.context.setAuthToken(e.authToken),a.context.setUserName(n),v.saveAuthToken(e.authToken),a.props.onLoginSuccess()}).catch(function(e){a.setState({error:e.error})})},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state.error;return r.a.createElement("form",{className:"LoginForm",onSubmit:this.handleSubmitJwtAuth},r.a.createElement("div",{role:"alert"},e&&r.a.createElement("p",{className:"red"},e)),r.a.createElement("div",{className:"user_name"},r.a.createElement("label",{htmlFor:"LoginForm__user_name"},"User name"),r.a.createElement(T,{required:!0,name:"user_name",id:"LoginForm__user_name"})),r.a.createElement("div",{className:"password"},r.a.createElement("label",{htmlFor:"LoginForm__password"},"Password"),r.a.createElement(T,{required:!0,name:"password",type:"password",id:"LoginForm__password"})),r.a.createElement(w,{type:"submit"},"Login"))}}]),t}(n.Component);H.contextType=b,H.defaultProps={onLoginSuccess:function(){}};var q=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).handleLoginSuccess=function(){var e=a.props,t=e.location,n=e.history,r=(t.state||{}).from||"/";n.push(r)},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(C,{className:"LoginPage"},r.a.createElement("h2",null,"Login"),r.a.createElement(H,{onLoginSuccess:this.handleLoginSuccess}))}}]),t}(n.Component);q.contextType=b,q.defaultProps={location:{},history:{push:function(){}}};var B=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={error:null},a.handleSubmit=function(e){e.preventDefault();var t=e.target,n=t.user_name,r=t.password;a.setState({error:null}),F.postUser({user_name:n.value,password:r.value}).then(function(e){n.value="",r.value="",a.props.onRegistrationSuccess()}).catch(function(e){a.setState({error:e.error})})},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state.error;return r.a.createElement("form",{className:"RegistrationForm",onSubmit:this.handleSubmit},r.a.createElement("div",{role:"alert"},e&&r.a.createElement("p",{className:"red"},e)),r.a.createElement("div",{className:"user_name"},r.a.createElement("label",{htmlFor:"RegistrationForm__user_name"},"User name ",r.a.createElement(_,null)),r.a.createElement(T,{name:"user_name",type:"text",required:!0,id:"RegistrationForm__user_name"})),r.a.createElement("div",{className:"password"},r.a.createElement("label",{htmlFor:"RegistrationForm__password"},"Password ",r.a.createElement(_,null)),r.a.createElement(T,{name:"password",type:"password",required:!0,id:"RegistrationForm__password"})),r.a.createElement(w,{type:"submit"},"Register"))}}]),t}(n.Component);B.defaultProps={onRegistrationSuccess:function(){}},(function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).handleRegistrationSuccess=function(e){a.props.history.push("/login")},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(C,{className:"RegistrationPage"},r.a.createElement("h2",null,"Register"),r.a.createElement(B,{onRegistrationSuccess:this.handleRegistrationSuccess}))}}]),t}(n.Component)).defaultProps={history:{push:function(){}}};var J=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(C,{className:"NotFoundPage"},r.a.createElement("h2",null,"404 - Page not found"),r.a.createElement("p",null,"Try going back to your previous page."))}}]),t}(n.Component),U=(a(206),function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={error:null},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.state.error,a=this.props.routes.map(function(t){return e.props.routeShortName==t.routeShortName?r.a.createElement("option",{selected:!0,value:t.routeShortName},t.routeShortName):r.a.createElement("option",{value:t.routeShortName},t.routeShortName)});return r.a.createElement("form",{className:"LateBusForm",onSubmit:this.props.handleSubmit},r.a.createElement("div",{role:"alert"},t&&r.a.createElement("p",{className:"red"},t)),r.a.createElement("div",{className:"stop-id"},r.a.createElement("label",{htmlFor:"stop_id"},"Stop ID"),r.a.createElement(T,{required:!0,name:"stopId",type:"text",id:"stopId",value:this.props.stopId,disabled:!0,onChange:this.props.handleChangeStopId})),r.a.createElement("div",{className:"stop-id"},r.a.createElement("label",{htmlFor:"route"},"Route"),r.a.createElement("select",{required:!0,name:"route",id:"route",className:"Select",disabled:!0,onChange:this.props.handleChangeRouteName},a)),r.a.createElement("hr",null),r.a.createElement("div",{className:""},r.a.createElement("label",{htmlFor:"route"},"How late is the bus?"),r.a.createElement("select",{required:!0,name:"route",id:"route",className:"Select",onChange:this.props.handleChangeDelay},r.a.createElement("option",{value:"10-min-late"},"10 minutes late"),r.a.createElement("option",{value:"0-min-late",selected:!0},"On time"),r.a.createElement("option",{value:"10-min-early"},"10 minutes early"))),r.a.createElement(w,{type:"submit"},"Submit"))}}]),t}(n.Component));U.contextType=b;var M=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={stopId:null,routeShortName:null,delay:0},a.handleChangeStopId=function(e){a.setState({stopId:e.target.value})},a.handleChangeRouteName=function(e){a.setState({route:e.target.value})},a.handleChangeDelay=function(e){a.setState({delay:e.target.value})},a.handleSubmit=function(e){var t=a.props,n=(t.location,t.history);e.preventDefault();var r={stop_number:a.state.stopId,route_short_name:a.state.routeShortName,delay_time:a.state.delay};x.postDelay(r),n.push("/")},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.context.clearError();var e=this.props.location.state,t=e.stopId,a=e.routeShortName;this.setState({stopId:t,routeShortName:a}),x.getRoutes().then(this.context.setRouteList).catch(this.context.setError)}},{key:"render",value:function(){return console.log(this.context.routeList),r.a.createElement(C,{className:"LateBusPage"},r.a.createElement(U,{routes:this.context.routeList,stopId:this.state.stopId,routeShortName:this.state.routeShortName,handleChangeStopId:this.handleChangeStopId,handleChangeRouteName:this.handleChangeRouteName,handleChangeDelay:this.handleChangeDelay,handleSubmit:this.handleSubmit}))}}]),t}(n.Component);M.contextType=b,M.defaultProps={location:{},history:{push:function(){}}};var G=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={isLoading:!1,firstLoad:!0,message:"hi"},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(O,{loading:this.state.isLoading}),r.a.createElement(A,null),r.a.createElement("main",{className:"App"},r.a.createElement(N,{message:"Please enter a stop ID number above to search for bus times.",isActive:!1}),r.a.createElement(y.d,null,r.a.createElement(y.b,{exact:!0,path:"/",component:P}),r.a.createElement(D,{path:"/late",component:M}),r.a.createElement(y.b,{component:J}))))}}]),t}(n.Component);s.a.render(r.a.createElement(c.a,null,r.a.createElement(E,null,r.a.createElement(G,null))),document.getElementById("root"))},78:function(e,t,a){e.exports=a.p+"static/media/loading.bbf63906.jpg"},82:function(e,t,a){e.exports=a(207)},87:function(e,t,a){},88:function(e,t,a){},89:function(e,t,a){},90:function(e,t,a){}},[[82,1,2]]]);
//# sourceMappingURL=main.5a192471.chunk.js.map